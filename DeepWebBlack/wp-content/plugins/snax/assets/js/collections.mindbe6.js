"undefined"==typeof window.snax_collections&&(window.snax_collections={}),function(a,b){"use strict";b.AddPopup=function(){var c,d,e={},f={},g={},h={popup:"#snax-popup-add-to-collection",popupInner:".snax-add-to-collection",leading:".snax-collections-leading",searchInput:"input[name=snax-collection-search]",searchSubmit:"input[name=snax-collection-save]",searchForm:"form.snax-form-collection-search",items:".snax-collections-items",item:".snax-collections-item",itemTitle:".snax-collection-title",itemTitleLink:".snax-collection-title > a",publicItemTpl:".snax-collections-item > .snax-collection-public",privateItemTpl:".snax-collections-item > .snax-collection-private"},i={popupLoading:"snax-add-to-collection-loading"};e.open=function(a,b){if(g={postId:a,nonce:b},"function"!=typeof snax.openPopup)throw new Error("openPopup() not defined!");d.find(h.searchInput).val(""),snax.openPopup(d);var c=d.find(h.popupInner),e=d.find(h.leading);c.addClass(i.popupLoading),e.hide(),j(function(a,b){c.removeClass(i.popupLoading),0===b&&e.show()})},e.close=function(){snax.closePopup()};var j=function(b){var e=a.ajax({type:"GET",url:c.ajax_url,dataType:"json",data:{action:"snax_get_user_collections"}});e.done(function(a){var c="success"===a.status;if(c){var e=d.find(h.items);e.empty();for(var g in a.args.list){var i=a.args.list[g],j=f[i.visibility].clone(),k='<a href="#" data-snax-collection="'+i.ID+'">'+i.post_title+"</a>";j.find(h.itemTitle).html(k),e.append(j)}}"function"==typeof b&&b(c,a.args.list.length)})},k=function(b,d){var e=a.ajax({type:"POST",url:c.ajax_url,dataType:"json",data:{action:"snax_save_collection",security:g.nonce,snax_title:b}});e.done(function(a){var b="success"===a.status;d(!!b&&a.args.collection_id)})},l=function(){a(h.searchForm,d).on("submit",function(c){c.preventDefault();var d=a(this).find(h.searchInput).val();e.close(),k(d,function(a){if(!1===a)throw new Error("Collection not saved!");b.addToCollection(a,g.postId,g.nonce)})})},m=function(){d.on("click",h.item,function(c){c.preventDefault();var d=a(this).find("a").data("snax-collection");e.close(),b.addToCollection(d,g.postId,g.nonce)})},n=function(){var b=function(b){var c=d.find(h.itemTitleLink);d.find(h.item).show(),0!==b.length&&(b=b.toLowerCase(),c.each(function(){var c=a(this).text().toLowerCase();-1===c.indexOf(b)&&a(this).parents(h.item).hide()}))};d.find(h.searchInput).on("keyup",function(){var c=a(this).val(),e=d.find(h.searchSubmit);c.length>0?e.removeAttr("disabled"):e.attr("disabled","disabled"),b(c)})},o=function(){l(),m(),n()},p=function(){if(d=a(h.popup),0===d.length)throw new Error("Add collection popup not found!");return c=a.parseJSON(snax_collections_js_config),f.public=d.find(h.publicItemTpl).parent().detach(),f.private=d.find(h.privateItemTpl).parent().detach(),o(),e};return p()}}(jQuery,snax_collections),function(a,b){"use strict";var c,d,e={postContainer:".snax-post-container",collectionItems:".snax-collection-items",collectionItem:".snax-collection-item",actions:".snax-collection-actions",addAction:".snax-action-add-to-collection",clearAllAction:".snax-collection-action-clear-all",removeCollectionAction:".snax-collection-action-delete",removePostAction:".snax-collection-action-remove-post",itemCount:".snax-collection-item-count",featuredMedia:".snax-collection-essentials .entry-featured-media .g1-frame-inner",meta:".snax-collection-essentials .snax-collection-meta",editForm:"form.snax-edit-collection",cancelAction:".snax-edit-collection-actions > a",mediaForm:".snax-media-upload-form",titleField:"input[name=snax-title]",descriptionField:"textarea[name=snax-description]",visibilityField:"input[name=snax-visibility]",featuredMediaField:"input[name=snax-featured-image]"},f={itemAdded:"snax-collection-item-added",itemAdding:"snax-collection-item-adding",itemRemoved:"snax-collection-item-removed",itemRemoving:"snax-collection-item-removing"};b.addToCollection=function(b,d,e,f){var g=a.ajax({type:"POST",url:c.ajax_url,dataType:"json",data:{action:"snax_add_to_collection",security:e,snax_collection:b,snax_post_id:d}});g.done(function(a){var b="success"===a.status;b&&snax.notifications&&snax.notifications.add(a.args.html),"function"==typeof f&&f(b)})},b.removeCollection=function(b,d,e){var f=a.ajax({type:"POST",url:c.ajax_url,dataType:"json",data:{action:"snax_remove_collection",security:d,snax_collection_id:b}});f.done(function(a){var b="success"===a.status;e(b)})},b.removePost=function(b,d,e,f){var g=a.ajax({type:"POST",url:c.ajax_url,dataType:"json",data:{action:"snax_remove_post_from_collection",security:e,snax_post_id:b,snax_collection_id:d}});g.done(function(a){var b="success"===a.status;f(b)})},b.clearAll=function(b,d){var e=a.ajax({type:"POST",url:c.ajax_url,dataType:"json",data:{action:"snax_remove_all_from_collection",security:d,snax_collection_id:b}});e.done(function(a){var b="success"===a.status;b&&window.location.reload()})},b.updateCollectionFeaturedImage=function(b){var d=a.ajax({type:"GET",url:c.ajax_url,dataType:"json",data:{action:"snax_get_collection_featured_media",snax_collection_id:b}});d.done(function(b){var c="success"===b.status;if(c){var d=a(e.featuredMedia),f=d.find("img"),g=a(b.args.html);f.attr("src")!==g.attr("src")&&d.html(g)}})},b.updateCollectionMeta=function(b){var d=a.ajax({type:"GET",url:c.ajax_url,dataType:"json",data:{action:"snax_get_collection_meta",snax_collection_id:b}});d.done(function(b){var c="success"===b.status;c&&a(e.meta).replaceWith(b.args.html)})},b.saveCollection=function(b,d,e){var f=a.ajax({type:"POST",url:c.ajax_url,dataType:"json",data:{action:"snax_save_collection",security:c.nonce,snax_collection_id:b,snax_title:d.title||"",snax_description:d.description||"",snax_visibility:d.visibility||"private",snax_featured_media:d.featuredMedia||""}});f.done(function(a){var b="success"===a.status;e&&e(b,a.args.collection_url)})},b.addToCollectionEvent=function(){a("body").on("click",e.addAction,function(){var e=a(this),g=parseInt(c.user_id,10);if(!g)return void(window.location.href=e.data("snax-redirect"));var h=e.data("snax-collection"),i=e.data("snax-post"),j=e.data("snax-nonce");h&&i&&j&&("custom"===h?(d||(d=b.AddPopup()),d.open(i,j)):(e.addClass(f.itemAdding),b.addToCollection(h,i,j,function(a){a&&(e.addClass(f.itemAdded),e.prop("disabled",!0))})))})},b.removeCollectionEvent=function(){a("body").on("click",e.removeCollectionAction,function(){if(confirm(c.i18n.are_you_sure_remove)){var d=a(this),f=parseInt(c.user_id,10);if(0!==f){var g=d.parents(e.actions),h=g.data("snax-collection"),i=g.data("snax-nonce");h&&i&&(snax.notifications&&snax.notifications.add(c.i18n.removed),b.removeCollection(h,i,function(a){a&&(window.location.href=c.home_url)}))}}})},b.removeFromCollectionEvent=function(){a("body").on("click",e.removePostAction,function(){var d=a(this),g=parseInt(c.user_id,10);if(0!==g){var h=d.data("snax-post"),i=d.parents(e.collectionItems).data("snax-collection"),j=d.data("snax-nonce");if(h&&i&&j){var k=d.parents(e.collectionItem);k.addClass(f.itemRemoving),b.removePost(h,i,j,function(a){a&&(k.addClass(f.itemRemoved),k.slideToggle(375),setTimeout(function(){var a=d.parents(e.postContainer).find(e.itemCount);a.text(parseInt(a.text(),10)-1)},375),b.updateCollectionFeaturedImage(i),b.updateCollectionMeta(i))})}}})},b.clearAllEvent=function(){a("body").on("click",e.clearAllAction,function(){if(confirm(c.i18n.are_you_sure_clear_all)){var d=parseInt(c.user_id,10);if(0!==d){var f=a(this).parents(e.actions),g=f.data("snax-collection"),h=f.data("snax-nonce");g&&h&&(snax.notifications&&snax.notifications.add(c.i18n.removing_items),b.clearAll(g,h))}}})},b.clearPreviewEvent=function(){var b=a(e.editForm);b.find("a.snax-media-action-delete-featured").parents(".snax-object-actions").remove();var c=b.find("a.snax-delete-collection-image").parents(".snax-object-actions").hide(),d=b.find("#snax-featured-image");if(d.length>0){var f=c.clone();f.insertAfter(d.find(".snax-object-container")).show(),f.on("click","a.snax-delete-collection-image",function(c){c.preventDefault(),b.find(e.featuredMediaField).val(""),a("#snax-featured-image").empty(),b.find(".snax-tab-content-featured-image").addClass("snax-tab-content-visible").removeClass("snax-tab-content-hidden")})}},b.editFormEvents=function(){var c=a(e.editForm),d=c.find(e.mediaForm);d.on("snaxFileUploaded",function(a,b){c.find(e.featuredMediaField).val(b)}),b.clearPreviewEvent(),d.on("snaxPreviewLoaded",function(a,c){b.clearPreviewEvent()}),c.on("submit",function(a){a.preventDefault();var d=c.data("snax-collection"),f=c.find(e.titleField).val();if(0===f.length)return void alert("Please fill in the title");var g=c.find(e.descriptionField).val(),h=c.find(e.visibilityField+":checked").val(),i=c.find(e.featuredMediaField).val(),j={title:f,description:g,visibility:h,featuredMedia:i},k=c.find("input[type=submit]");k.attr("disabled","disabled"),b.saveCollection(d,j,function(a,b){a?window.location.href=b:k.removeAttr("disabled")})}),c.on("click",e.cancelAction,function(){a(this).css("pointerEvents","none")})},b.bindEvents=function(){b.addToCollectionEvent(),b.removeCollectionEvent(),b.removeFromCollectionEvent(),b.clearAllEvent(),b.editFormEvents()},b.storeInHistory=function(b){c.user_id<=0||a.ajax({type:"POST",url:c.ajax_url,dataType:"json",data:{action:"snax_add_to_collection",security:c.nonce,snax_post_id:b,snax_collection:"history"}})},b.init=function(){c=a.parseJSON(snax_collections_js_config),b.bindEvents(),"on"===c.history&&c.post_id>0&&b.storeInHistory(c.post_id)},a(document).ready(function(){b.init()})}(jQuery,snax_collections);